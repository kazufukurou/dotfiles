#!/bin/bash

usage() {
    echo "Usage: `basename $0` <push|pull> <all|music> PATH DEST" && exit 1
}

args=(-rvlc --delete)
if [ "$2" = "music" ]; then
    args+=(--include='*/' --include='*.txt' --include='cover.*' --exclude='*')
    dest=$4:backups/Music
elif [ "$2" = "all" ]; then
    dest=$4:backups/$3
fi

[ -z "$3" ] || [ -z "$4" ] || [ -z "$dest" ] && usage
srcdst=()
[ "$1" = "push" ] && srcdst=($3/ $dest)
[ "$1" = "pull" ] && srcdst=($dest/ $3)
[ ${#srcdst[@]} -eq 0 ] && usage

rsync --dry-run ${args[@]} ${srcdst[@]}
echo
read -r -p "Does this look right? [y/N] " response
[ "$response" = "y" ] && rsync ${args[@]} ${srcdst[@]}
