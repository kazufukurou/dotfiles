#!/bin/sh
# Converts all flacs in directory to mp3

for a in *.flac; do
    outf=${a%.flac}.mp3

    artist=`metaflac "$a" --show-tag=ARTIST | sed s/.*=//g`
    title=`metaflac "$a" --show-tag=TITLE | sed s/.*=//g`
    album=`metaflac "$a" --show-tag=ALBUM | sed s/.*=//g`
    genre=`metaflac "$a" --show-tag=GENRE | sed s/.*=//g`
    tracknumber=`metaflac "$a" --show-tag=TRACKNUMBER | sed s/.*=//g`
    date=`metaflac "$a" --show-tag=DATE | sed s/.*=//g`

    flac -c -d "$a" | lame --noreplaygain -V0 \
        --add-id3v2 --pad-id3v2 --ignore-tag-errors --tt "$title" --tn "${tracknumber:-0}" \
        --ta "$artist" --tl "$album" --ty "$date" --tg "${genre:-12}" \
        - "$outf"
    result=$?
    if [ "$1" ] && [ "$1" = "-d" ] && [ $result -eq 0 ]; then
        rm "$a"
    fi
done
