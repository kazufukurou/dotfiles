#!/bin/bash

androidSrc=$ANDROID_HOME/sources/android-27
imports='^import \(android\|java\)\.[^*]*$'
replace="s#import \(.*\)#$androidSrc\/\1.java#"
androidPaths=$(grep -rh --include='*.kt' --include='*.java' "$imports" . | sort | uniq | tr . / | sed "$replace")

paths="
$androidPaths
$HOME/Repos/kotlin/libraries/stdlib/common/src
$HOME/Repos/kotlin/libraries/stdlib/src
"
ktRegexCommon='/(fun\s[^()]*\.)([a-zA-Z0-9_]+)/\2/d,definition/'
ktArgs="--langdef=Kotlin --langmap=Kotlin:.kt --regex-Kotlin="
javaArgs="--langmap=Java:.java"
commonArgs="--recurse --verbose --languages=Java,Kotlin"

ctags $javaArgs $ktArgs$ktRegexCommon $commonArgs --exclude="*/internal" $paths

sed -i '/ private /d' $fileTags
sed -i '/ volatile /d' $fileTags
sed -i '/ native /d' $fileTags
sed -i '/^m[A-Z]/d' $fileTags

if [ -f ./gradlew ]; then
  ktRegex='/(class\s|object\s|interface\s|const\sval\s|fun\s|fun\s[a-zA-Z]+\.|^\s\sva[lr]\s)([a-zA-Z0-9_]+)/\2/d,definition/'
  ctags -a $javaArgs $ktArgs$ktRegex $commonArgs */src/main/kotlin */src/main/java
fi
