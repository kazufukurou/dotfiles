#!/bin/bash

usage() {
    echo "Usage: `basename $0` <push|pull> <all|music> PATH user@host [-f]"
    exit 1
}

cmd=$1
cfg=$2
src=$3
host=$4
[ "$5" = "-f" ] && dry="" || dry="--dry-run"
if [ "$cfg" = "music" ]; then
    args=(-avz --delete --include='*/' --include='*.txt' --include='cover.*' --exclude='*')
    dest=$host:backups/Music
elif [ "$cfg" = "all" ]; then
    args=(-avz --delete)
    dest=$host:backups/$src
else usage
fi
if [ "$cmd" = "push" ]; then
    rsync $dry ${args[@]} $src/ $dest
elif [ "$cmd" = "pull" ]; then
    rsync $dry ${args[@]} $dest/ $src
else usage
fi
