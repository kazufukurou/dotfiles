#!/bin/bash

usage() {
    echo "Usage: `basename $0` <push|pull> <all|music> PATH user@host [-f]"
    exit 1
}

cmd=$1
cfg=$2
src=$3
dest=$4
[ "$5" = "-f" ] && dry="" || dry="--dry-run"
if [ "$cfg" = "music" ]; then
    args=(-rvlc --delete --include='*/' --include='*.txt' --include='cover.*' --exclude='*')
    destdir=$dest:backups/Music
elif [ "$cfg" = "all" ]; then
    args=(-rvlc --delete)
    destdir=$dest:backups/$src
else
    usage
fi
if [ ! -z "$src" ] && [ ! -z "$dest" ]; then
    if [ "$cmd" = "push" ]; then
        rsync $dry ${args[@]} $src/ $destdir
    elif [ "$cmd" = "pull" ]; then
        rsync $dry ${args[@]} $destdir/ $src
    else
        usage
    fi
else
    usage
fi
