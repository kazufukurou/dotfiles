#!/bin/sh

chr() {
  printf \\$(printf '%03o' $1)
}

ord() {
  printf '%d' "'$1"
}

titles() {
    n=0
    for wid in $(lsw -a | grep -v $(pfw)); do
        group=$(xprop -id $wid WMG | grep 'WMG(STRING) =' | cut -d\" -f2)
        if [ -n "$group" ]; then
            n=$((n+1))
            l=$(chr $((n+96)))
            echo "$wid^$l $(xprop -id $wid _NET_WM_NAME | cut -d\" -f2)"
        fi
    done
}

n=$(titles | wc -l)
if [ $n -eq 1 ]; then
    wmc focus $(titles | cut -d^ -f1)
elif [ $n -gt 1 ]; then
    dmenu_opts="-l 26 -fn monospace:pixelsize=18 -nf #999999 -nb #666666 -sf #ffffff -sb #666666"
    win=$(titles | cut -d^ -f2 | dmenu $dmenu_opts | cut -d' ' -f1)
    win=$(ord $win)
    win=$((win-96))
    wmc focus $(titles | sed -n "$win p" | cut -d^ -f1)
fi
