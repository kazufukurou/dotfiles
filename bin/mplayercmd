#!/bin/sh

fifo=$HOME/.mplayer/fifo

f7=$(tput setaf 7)
f5=$(tput setaf 5)
f4=$(tput setaf 4)
f1=$(tput setaf 1)
f0=$(tput setaf 0)
c=$(tput sgr0)


if [ $# -eq 0 ] ; then
    [ -e "$fifo" ] && rm "$fifo"
    mkfifo "$fifo"
    mplayer -slave -quiet -idle -input file="$fifo" 2> /dev/null | grep --line-buffered -o "Playing .*" | sed "s%Playing /.*/\([^/]*\)/\([^ ]*\) \([^/]*\)/[^ ]\{2\} \([^/]*\)\..*\.%$f4\1 $f0\2 $f5\3 $f7\4$c%"
else
    echo "$@" > "$fifo"
fi

